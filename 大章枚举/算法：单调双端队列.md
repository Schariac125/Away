# ç®—æ³•ï¼šå•è°ƒåŒç«¯é˜Ÿåˆ—

## çŸ¥è¯†ç‚¹ï¼š

ç”¨æ¥è§£å†³ä¸€äº›åƒæ’é˜Ÿä¸€æ ·çš„é—®é¢˜

å…¶å®è¿˜æ˜¯æœ‰ç‚¹éš¾ä»¥ç†è§£ã€‚

```cpp
vector<int> prev(n);
stack<int> st;
for (int i=0;i<=n;i++){
    while (!st.empty()&&arr[st.top().]<=arr[i]){//è¿™ä¸ªæ“ä½œåªæ˜¯è®°å½•äº†ä¸‹æ ‡
        st.pop();
}
    prev[i]=st.empty()?-1:st.top();
    st.push(i);
}
```

å•è°ƒæ ˆæ¨¡æ¿ï¼š

å®šä¹‰å‡½æ•° *f*(*i*) ä»£è¡¨æ•°åˆ—ä¸­ç¬¬ *i* ä¸ªå…ƒç´ ä¹‹åç¬¬ä¸€ä¸ªå¤§äº *a**i* çš„å…ƒç´ çš„**ä¸‹æ ‡**ï¼Œå³ *f*(*i*)=min*i*<*j*â‰¤*n*,*a**j*>*a**i*{*j*}ã€‚è‹¥ä¸å­˜åœ¨ï¼Œåˆ™ *f*(*i*)=0ã€‚

è¯•æ±‚å‡º *f*(1â€¦*n*)ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;

int main(){
   int n;
   cin>>n;
   vector<int> arr(n+1);
   for (int i=1;i<=n;i++){
      cin>>arr[i];
   }
   stack<int> st;
   vector<int> v(n+1);
   for (int i=n;i>0;i--){
      while (!st.empty()&&arr[st.top()]<=arr[i]){
         st.pop();
      }
      v[i]=st.empty() ? 0:st.top();
      st.push(i);
   }
   for (int i=1;i<=n;i++){
      cout<<v[i]<<" ";
   }
   return 0;
}
```

å…³äºæ˜¯ä»åå¾€å‰è¿˜æ˜¯ä»å‰å¾€åéå†çš„è¿™ä¸ªé—®é¢˜

å®é™…ä¸Šæˆ‘ä»¬è¦å…³æ³¨çš„æ˜¯è¿™ä¸ªé¢˜ç›®å¯»æ‰¾çš„æ˜¯å·¦ä¾§å…ƒç´ è¿˜æ˜¯å³ä¾§å…ƒç´ 

å³ä¾§å…ƒç´ åˆ™åº”è¯¥è¦é€†åºï¼Œå·¦ä¾§å°±æ˜¯æ­£åº

ä¸‹é¢ç»™å‡ºAIæ€»ç»“çš„è§„å¾‹ï¼š

### å¯»æ‰¾"å³ä¾§ç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´ "é—®é¢˜çš„å†…åœ¨è§„å¾‹

ç¡®å®å­˜åœ¨ä¸€ä¸ªæ¸…æ™°å¯å¾ªçš„è§„å¾‹ï¼Œè¿™ç§è§£æ³•å±•ç°äº†**å•è°ƒæ ˆ**åœ¨å¤„ç†"ä¸‹ä¸€ä¸ªæ›´å¤§/å°å…ƒç´ "ç±»é—®é¢˜æ—¶çš„é€šç”¨æ¨¡å¼ï¼š

#### ğŸ”‘ æ ¸å¿ƒè§„å¾‹ä¸‰è§’ (å¤„ç†è¿™ç±»é—®é¢˜çš„é»„é‡‘ç»„åˆ)

1. **éå†æ–¹å‘ â‡¨ ä¿¡æ¯æ–¹å‘**ï¼š

   - æŸ¥æ‰¾ **å³ä¾§** æ›´å¤§å…ƒç´  â†’ **é€†åºéå†**ï¼ˆä»å³å‘å·¦ï¼‰
   - æŸ¥æ‰¾ **å·¦ä¾§** æ›´å¤§å…ƒç´  â†’ **æ­£åºéå†**ï¼ˆä»å·¦å‘å³ï¼‰

2. **æ ˆçš„æ€§è´¨ â‡¨ é—®é¢˜éœ€æ±‚**ï¼š

   - å¯»æ‰¾ç¬¬ä¸€ä¸ª **æ›´å¤§** çš„å…ƒç´  â†’ **å•è°ƒé€’å‡æ ˆ**
   - å¯»æ‰¾ç¬¬ä¸€ä¸ª **æ›´å°** çš„å…ƒç´  â†’ **å•è°ƒé€’å¢æ ˆ**

3. **å‡ºæ ˆæ¡ä»¶ â‡¨ æ— æ•ˆå€™é€‰åˆ¤å®š**ï¼š

   ```
   while (!st.empty() && arr[st.top()] <= arr[i]) st.pop();
   ```

   - ç§»é™¤ **å€¼â‰¤å½“å‰å€¼** çš„å…ƒç´ ï¼ˆå› ä¸ºå½“å‰å…ƒç´ æ›´ä¼˜ï¼‰
   - ä¿ç•™çš„å¯èƒ½å€™é€‰å¿…é¡»æ»¡è¶³ **å€¼>å½“å‰å€¼**ï¼ˆä¿è¯å•è°ƒæ€§ï¼‰

#### ğŸ“ å››è±¡é™å†³ç­–çŸ©é˜µ (é—®é¢˜ç±»å‹Ã—è§£æ³•é€‰æ‹©)

| ç›®æ ‡æ–¹å‘ â†“ | å•è°ƒæ ˆç±»å‹ â†’ | é€’å‡æ ˆ(æ‰¾æ›´å¤§å…ƒç´ )       | é€’å¢æ ˆ(æ‰¾æ›´å°å…ƒç´ )       |
| ---------- | ------------ | ------------------------ | ------------------------ |
| **å³ä¾§**   | é€†åºéå†     | âœ… æ ‡å‡†è§£æ³•ï¼šå½“å‰é—®é¢˜     | âœ… å¦‚ï¼šå³ä¾§ç¬¬ä¸€ä¸ªæ›´å°å…ƒç´  |
| **å·¦ä¾§**   | æ­£åºéå†     | âœ… å¦‚ï¼šå·¦ä¾§ç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´  | âœ… å¦‚ï¼šå·¦ä¾§ç¬¬ä¸€ä¸ªæ›´å°å…ƒç´  |

#### ğŸ’¡ é€šç”¨æ¨¡æ¿ (è§£å†³è¿™ç±»é—®é¢˜çš„ä»£ç ç»“æ„)

```cpp
vector<int> solve(vector<int>& arr) {
    int n = arr.size();
    vector<int> res(n);
    stack<int> st;
    
    for (int i = [èµ·å§‹]; [ç»ˆæ­¢]; [æ­¥é•¿]) {
        // æ¸…ç†æ— æ•ˆå€™é€‰ (æ ¸å¿ƒwhileå¾ªç¯)
        while (!st.empty() && shouldPop(st.top(), i)) 
            st.pop();
        
        // è®°å½•ç»“æœ (æ³¨æ„ç©ºæ ˆå¤„ç†)
        res[i] = st.empty() ? fallback : st.top();
        
        st.push(i);  // å½“å‰å…ƒç´ æˆä¸ºæ–°å€™é€‰
    }
    return res;
}
```

#### ğŸŒ° å®ä¾‹éªŒè¯ï¼ˆç”¨è§„å¾‹è§£å†³æ–°é—®é¢˜ï¼‰

**é—®é¢˜**ï¼šæŸ¥æ‰¾å·¦ä¾§ç¬¬ä¸€ä¸ªæ›´å°å…ƒç´ 
 â€‹**â€‹è§£æ³•é€‰æ‹©â€‹**â€‹ï¼š

1. æ–¹å‘ï¼šå·¦ä¾§ â†’ æ­£åºéå† (ä»å·¦å‘å³)
2. æ ˆå‹ï¼šé€’å¢æ ˆï¼ˆæ‰¾æ›´å°å…ƒç´ ï¼‰
3. å‡ºæ ˆæ¡ä»¶ï¼š`arr[st.top()] >= arr[i]`

```cpp
// å·¦ä¾§ç¬¬ä¸€ä¸ªæ›´å°å…ƒç´ 
vector<int> leftSmaller(vector<int>& arr) {
    stack<int> st;
    vector<int> res(arr.size());
    
    for (int i = 0; i < arr.size(); i++) {
        // ç»´æŠ¤å•è°ƒé€’å¢æ ˆ
        while (!st.empty() && arr[st.top()] >= arr[i]) 
            st.pop();
            
        res[i] = st.empty() ? -1 : st.top();
        st.push(i);
    }
    return res;
}
```

#### âš™ ä¸ºä»€ä¹ˆè¿™ä¸ªè§„å¾‹æœ‰æ•ˆï¼Ÿ

1. **æ—¶ç©ºå±€éƒ¨æ€§åŸç†**ï¼š
   - é‚»è¿‘å…ƒç´ å…·æœ‰ç›¸å…³æ€§ï¼ˆç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´ é€šå¸¸ä¸ä¼šå¾ˆè¿œï¼‰
   - æ ˆç»´æŠ¤äº†å¯èƒ½çš„å€™é€‰é›†ï¼Œé¿å…å…¨é‡æœç´¢
2. **å¤šç±³è¯ºæ·˜æ±°æ•ˆåº”**ï¼š
   - å½“é‡åˆ°å…ƒç´ Aæ—¶ï¼Œæ‰€æœ‰å€¼â‰¤Açš„å³ä¾§å…ƒç´ å¤±æ•ˆï¼ˆè¢«å¼¹å‡ºï¼‰
   - è¿™äº›è¢«æ·˜æ±°çš„å…ƒç´ å¯¹ä¹‹åæ›´å·¦ä¾§çš„å…ƒç´ ä¹Ÿæ— æ•ˆï¼ˆä¼ é€’æ€§ï¼‰
3. **æœ€ä¼˜å€™é€‰ä¿ç•™æœºåˆ¶**ï¼š
   - æ ˆé¡¶å§‹ç»ˆæ˜¯æœ€è¿‘çš„æœ‰æ•ˆå€™é€‰ï¼ˆä¸‹æ ‡æœ€å¤§ï¼‰
   - æ ˆåº•ä¿ç•™è¿œæœŸä½†å€¼æ›´ä¼˜çš„å€™é€‰ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰

### åŒç«¯é˜Ÿåˆ—ï¼š

ç”¨äºè§£å†³å®šåŒºé—´å†…çš„é—®é¢˜ï¼Œå¯ä»¥åŒæ—¶å¤„ç†çª—å£çš„å…ƒç´ æœ€å¤§å€¼ä¸æœ€å°å€¼

ä»£ç å¦‚ä¸‹ï¼ˆæ±‚åŒç«¯é˜Ÿåˆ—çª—å£æœ€å¤§å€¼ï¼‰

```cpp
vector<int> win(n);
deque<int> dep;//dequeå°±æ˜¯åŒç«¯é˜Ÿåˆ—ï¼Œå¯ä»¥ä»ä¸¤å¤´è¿›å‡º
for (int i=0;i<n;i++){
    while (!deq.empty()&&arr[dep.back()]<=arr[i]){
        dep.pop_back();
    }
    while (!dep.empty()&&dep.front<=i-k){
        dep.pop_front();
    }
    dep.push_back(i);
    win[i]=arr[deq.front()];
}
```

**åŒç«¯é˜Ÿåˆ—å¯¹æ¯”ä¸Šå•ç«¯é˜Ÿåˆ—çš„åŒºåˆ«å…¶å®å°±æ˜¯ä»¥ä¸‹å‡ ç‚¹ï¼š**

**1.åŒç«¯é˜Ÿåˆ—ä¸€èˆ¬ä¸ç”¨è€ƒè™‘å‰åçš„é—®é¢˜ï¼Œå¯¹æ¯”ä¸Šå•ç«¯çš„é˜Ÿåˆ—ï¼Œè¿™å…¶å®åªæ˜¯åŠ äº†ä¸€ä¸ªè¶…å‡ºçª—å£æ—¶çš„åˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯ç¬¬7è¡Œå’Œç¬¬8è¡Œä¹‹é—´çš„å†…å®¹**

## ä¾‹é¢˜ï¼šåŒç«¯é˜Ÿåˆ—æ¨¡æ¿é¢˜ï¼š

### P1886 æ»‘åŠ¨çª—å£ /ã€æ¨¡æ¿ã€‘å•è°ƒé˜Ÿåˆ—

## é¢˜ç›®æè¿°

æœ‰ä¸€ä¸ªé•¿ä¸º $n$ çš„åºåˆ— $a$ï¼Œä»¥åŠä¸€ä¸ªå¤§å°ä¸º $k$ çš„çª—å£ã€‚ç°åœ¨è¿™ä¸ªä»å·¦è¾¹å¼€å§‹å‘å³æ»‘åŠ¨ï¼Œæ¯æ¬¡æ»‘åŠ¨ä¸€ä¸ªå•ä½ï¼Œæ±‚å‡ºæ¯æ¬¡æ»‘åŠ¨åçª—å£ä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚

ä¾‹å¦‚ï¼Œå¯¹äºåºåˆ— $[1,3,-1,-3,5,3,6,7]$ ä»¥åŠ $k = 3$ï¼Œæœ‰å¦‚ä¸‹è¿‡ç¨‹ï¼š

$$\def\arraystretch{1.2}
\begin{array}{|c|c|c|}\hline
\textsf{çª—å£ä½ç½®} & \textsf{æœ€å°å€¼} & \textsf{æœ€å¤§å€¼} \\ \hline
\verb![1   3  -1] -3   5   3   6   7 ! & -1 & 3 \\ \hline
\verb! 1  [3  -1  -3]  5   3   6   7 ! & -3 & 3 \\ \hline
\verb! 1   3 [-1  -3   5]  3   6   7 ! & -3 & 5 \\ \hline
\verb! 1   3  -1 [-3   5   3]  6   7 ! & -3 & 5 \\ \hline
\verb! 1   3  -1  -3  [5   3   6]  7 ! & 3 & 6 \\ \hline
\verb! 1   3  -1  -3   5  [3   6   7]! & 3 & 7 \\ \hline
\end{array}
$$

## è¾“å…¥æ ¼å¼

è¾“å…¥ä¸€å…±æœ‰ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ­£æ•´æ•° $n,k$ã€‚
ç¬¬äºŒè¡Œ $n$ ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºåºåˆ— $a$

## è¾“å‡ºæ ¼å¼

è¾“å‡ºå…±ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œä¸ºæ¯æ¬¡çª—å£æ»‘åŠ¨çš„æœ€å°å€¼   
ç¬¬äºŒè¡Œä¸ºæ¯æ¬¡çª—å£æ»‘åŠ¨çš„æœ€å¤§å€¼

## è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1

### è¾“å…¥ #1

```
8 3
1 3 -1 -3 5 3 6 7
```

### è¾“å‡º #1

```
-1 -3 -3 -3 3 3
3 3 5 5 6 7
```

## è¯´æ˜/æç¤º

ã€æ•°æ®èŒƒå›´ã€‘    
å¯¹äº $50\%$ çš„æ•°æ®ï¼Œ$1 \le n \le 10^5$ï¼›  
å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le k \le n \le 10^6$ï¼Œ$a_i \in [-2^{31},2^{31})$ã€‚

### é¢˜è§£ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;

int main(){
   int n,k;
   cin>>n>>k;
   vector<int> arr(n+2);
   deque<int> maxx;
   deque<int> minn;
   vector<int> mmax(n+1);
   vector<int> mmin(n+1);
   for (int i=1;i<=n;i++){
      cin>>arr[i];
   }
   for (int i=1;i<=n;i++){
      while (!maxx.empty()&&arr[maxx.back()]<=arr[i]){
         maxx.pop_back();
      }
      while (!maxx.empty()&&maxx.front()<=i-k){
         maxx.pop_front();
      }
      maxx.push_back(i);
      mmax[i]=arr[maxx.front()];
   }
   for (int i=1;i<=n;i++){
      while (!minn.empty()&&arr[minn.back()]>=arr[i]){
         minn.pop_back();
      }
      while (!minn.empty()&&minn.front()<=i-k){
         minn.pop_front();
      }
      minn.push_back(i);
      mmin[i]=arr[minn.front()];
   }
   for (int i=k;i<=n;i++){
      cout<<mmin[i]<<" ";
   }
   cout<<endl;
   for (int i=k;i<=n;i++){
      cout<<mmax[i]<<" ";
   }
   return 0;
}
```

## ä¾‹é¢˜ï¼šä¿¡å·å¡”

# P1901 å‘å°„ç«™

## é¢˜ç›®æè¿°

æŸåœ°æœ‰ $N$ ä¸ªèƒ½é‡å‘å°„ç«™æ’æˆä¸€è¡Œï¼Œæ¯ä¸ªå‘å°„ç«™ $i$ éƒ½æœ‰ä¸ç›¸åŒçš„é«˜åº¦ $H_i$ï¼Œå¹¶èƒ½å‘ä¸¤è¾¹ï¼ˆä¸¤ç«¯çš„å‘å°„ç«™åªèƒ½å‘ä¸€è¾¹ï¼‰åŒæ—¶å‘å°„èƒ½é‡å€¼ä¸º $V_i$ çš„èƒ½é‡ï¼Œå‘å‡ºçš„èƒ½é‡åªè¢«ä¸¤è¾¹**æœ€è¿‘çš„ä¸”æ¯”å®ƒé«˜**çš„å‘å°„ç«™æ¥æ”¶ã€‚æ˜¾ç„¶ï¼Œæ¯ä¸ªå‘å°„ç«™å‘æ¥çš„èƒ½é‡æœ‰å¯èƒ½è¢« $0$ æˆ– $1$ æˆ– $2$ ä¸ªå…¶ä»–å‘å°„ç«™æ‰€æ¥å—ã€‚

è¯·è®¡ç®—å‡ºæ¥æ”¶æœ€å¤šèƒ½é‡çš„å‘å°„ç«™æ¥æ”¶çš„èƒ½é‡æ˜¯å¤šå°‘ã€‚

## è¾“å…¥æ ¼å¼

ç¬¬ $1$ è¡Œä¸€ä¸ªæ•´æ•° $N$ã€‚

ç¬¬ $2$ åˆ° $N+1$ è¡Œï¼Œç¬¬ $i+1$ è¡Œæœ‰ä¸¤ä¸ªæ•´æ•° $H_i$ å’Œ $V_i$ï¼Œè¡¨ç¤ºç¬¬ $i$ ä¸ªå‘å°„ç«™çš„é«˜åº¦å’Œå‘å°„çš„èƒ½é‡å€¼ã€‚

## è¾“å‡ºæ ¼å¼

è¾“å‡ºä»…ä¸€è¡Œï¼Œè¡¨ç¤ºæ¥æ”¶æœ€å¤šèƒ½é‡çš„å‘å°„ç«™æ¥æ”¶åˆ°çš„èƒ½é‡å€¼ã€‚ç­”æ¡ˆä¸è¶…è¿‡ 32 ä½å¸¦ç¬¦å·æ•´æ•°çš„è¡¨ç¤ºèŒƒå›´ã€‚

## è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1

### è¾“å…¥ #1

```
3
4 2 
3 5 
6 10
```

### è¾“å‡º #1

```
7
```

## è¯´æ˜/æç¤º

å¯¹äº $40\%$ çš„æ•°æ®ï¼Œ$1\le N\le 5000,1\le H_i\le 10^5,1\le V_i\le 10^4$ã€‚

å¯¹äº $70\%$ çš„æ•°æ®ï¼Œ$1\le N\le 10^5,1\le H_i\le 2\times 10^9,1\le V_i\le 10^4$ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le N\le 10^6,1\le H_i\le 2\times 10^9,1\le V_i\le 10^4$ã€‚

### é¢˜è§£ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;
class fly{
   public:
   int h,v;
};
int main(){
   int n;
   cin>>n;
   vector<fly> arr(n+2);
   for (int i=1;i<=n;i++){
      cin>>arr[i].h>>arr[i].v;
   }
   stack<int> r;
   vector<int> ri(n+2);
   for (int i=n;i>=1;i--){
      while (!r.empty()&&arr[r.top()].h<=arr[i].h){
         r.pop();
      }
      ri[i]=r.empty()?0:r.top();
      r.push(i);
   }
   stack<int> l;
   vector<int> li(n+2);
   for (int i=1;i<=n;i++){
      while (!l.empty()&&arr[l.top()].h<=arr[i].h){
         l.pop();
      }
      li[i]=l.empty()?0:l.top();
      l.push(i);
   }
   int ans=-1;
   vector<int> cnt(n+2);
   for (int i=1;i<=n;i++){
      cnt[ri[i]]+=arr[i].v;
      cnt[li[i]]+=arr[i].v;
   }
   for (int i=1;i<=n;i++){
      if (cnt[i]>ans) ans=cnt[i];
   }
   cout<<ans<<endl;
   return 0;
}
```

## ä¾‹é¢˜ï¼šç†Šå¤§ç†ŠäºŒ

### é—®é¢˜æè¿°

ç†Šå¤§å’Œç†ŠäºŒåœ¨ç©æ¸¸æˆã€‚ä»–ä»¬å°† n*n* ä¸ªæ­£æ•´æ•° a1,a2,...,an*a*1,*a*2,...,*a**n* æ’æˆä¸€è¡Œï¼Œç„¶åå„ç”¨ä¸€ä¸ªé•¿åº¦ä¸º k*k* çš„æ¡†åœ¨è¿™ä¸ªæ•°ç»„ä¸­å„è‡ªéšæœºæ¡†é€‰å‡ºä¸€æ®µé•¿åº¦ä¸º k*k* çš„è¿ç»­å­åºåˆ—ï¼ˆéšæœºæ¡†é€‰æŒ‡åœ¨åˆæ³•çš„ nâˆ’k+1*n*âˆ’*k*+1 ä¸ªè¿ç»­å­åºåˆ—ä¸­å‡åŒ€éšæœºï¼‰ã€‚ç†Šå¤§è®°å½•äº†ä»–æ¡†å‡ºçš„ k*k* ä¸ªæ•°ä¸­çš„æœ€å¤§å€¼ P*P*ï¼Œç†ŠäºŒè®°å½•äº†ä»–æ¡†å‡ºçš„ k*k* ä¸ªæ•°çš„æœ€å°å€¼ Q*Q*ï¼Œä»–ä»¬çªç„¶æœ‰ä¸ªç–‘é—®ï¼šPâˆ’Q*P*âˆ’*Q* çš„æœŸæœ›æ˜¯å¤šå°‘ï¼Ÿ

**2024-11-27 Updateï¼šJava æ—¶é™è°ƒæ•´è‡³ 1s**

### è¾“å…¥æè¿°

è¾“å…¥å…± 22 è¡Œã€‚

ç¬¬ä¸€è¡Œä¸ºä¸¤ä¸ªæ­£æ•´æ•° n,k*n*,*k*ã€‚

ç¬¬äºŒè¡Œä¸º n*n* ä¸ªç”±ç©ºæ ¼éš”å¼€çš„æ­£æ•´æ•° a1,a2,...,an*a*1,*a*2,...,*a**n*ã€‚

### è¾“å‡ºæè¿°

è¾“å‡ºå…± 11 è¡Œï¼Œä¸€ä¸ªæµ®ç‚¹æ•°ï¼ˆè¯·ä¿ç•™ä¸¤ä½å°æ•°ï¼‰ã€‚

### æ ·ä¾‹è¾“å…¥

```text
3 2
1 2 3
```

### æ ·ä¾‹è¾“å‡º

```text
1.00
```

### æ ·ä¾‹è¯´æ˜

ä¸€å…±æœ‰å››ç§æƒ…å†µï¼š

ç†Šå¤§æ¡†å‡º [1,2][1,2]ï¼ŒP=2*P*=2ï¼›ç†ŠäºŒæ¡†å‡º [1,2][1,2]ï¼ŒQ=1*Q*=1ï¼ŒPâˆ’Q=1*P*âˆ’*Q*=1ã€‚

ç†Šå¤§æ¡†å‡º [1,2][1,2]ï¼ŒP=2*P*=2ï¼›ç†ŠäºŒæ¡†å‡º [2,3][2,3]ï¼ŒQ=2*Q*=2ï¼ŒPâˆ’Q=0*P*âˆ’*Q*=0ã€‚

ç†Šå¤§æ¡†å‡º [2,3][2,3]ï¼ŒP=3*P*=3ï¼›ç†ŠäºŒæ¡†å‡º [1,2][1,2]ï¼ŒQ=1*Q*=1ï¼ŒPâˆ’Q=2*P*âˆ’*Q*=2ã€‚

ç†Šå¤§æ¡†å‡º [2,3][2,3]ï¼ŒP=3*P*=3ï¼›ç†ŠäºŒæ¡†å‡º [2,3][2,3]ï¼ŒQ=2*Q*=2ï¼ŒPâˆ’Q=1*P*âˆ’*Q*=1ã€‚

æ‰€ä»¥ Pâˆ’Q*P*âˆ’*Q* çš„æœŸæœ›ä¸º(1+0+2+1)/4=1.00(1+0+2+1)/4=1.00ã€‚

### é¢˜è§£ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;
#define int long long
signed main(){
   int n,k;
   cin>>n>>k;
   vector<int> arr(n+2);
   for (int i=1;i<=n;i++){
      cin>>arr[i];
   }
   deque<int> maxx;
   vector<int> a(n+2);
   deque <int> minn;
   vector<int> b(n+2);
   for (int i=1;i<=n;i++){
      while (!maxx.empty()&&arr[maxx.back()]<=arr[i]){
         maxx.pop_back();
      }
      while (!maxx.empty()&&maxx.front()<=i-k){
         maxx.pop_front();
      }
      maxx.push_back(i);
      a[i]=arr[maxx.front()];
   }
   for (int i=1;i<=n;i++){
      while (!minn.empty()&&arr[minn.back()]>=arr[i]){
         minn.pop_back();
      }
      while (!minn.empty()&&minn.front()<=i-k){
         minn.pop_front();
      }
      minn.push_back(i);
      b[i]=arr[minn.front()];
   }
   int winnum=(n-k+1);
   double ans=0;
   for (int i=k;i<=n;i++){
      ans+=a[i];
   }
   for (int i=k;i<=n;i++){
      ans-=b[i];
   }
   ans/=winnum*1.00;
   printf("%.2f",ans);
   return 0;
}
```

**å¥—æ¨¡æ¿ï¼ŒçœŸçš„å¾ˆç¥å¥‡å§ï¼ˆ**

## ä¾‹é¢˜ï¼šæœ€å¤§åŒºé—´ï¼š

### é—®é¢˜æè¿°

ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n*n* çš„åºåˆ— Aiï¼Œæ±‚ L,R*L*,*R* ä½¿ (Râˆ’L+1)â‹…minâ¡(AL,AL+1,â€¦,AR)å°½å¯èƒ½å¤§ï¼Œå…¶ä¸­ minâ¡min è¡¨ç¤ºæœ€å°å€¼ã€‚

ä½ åªéœ€è¦è¾“å‡ºæœ€å¤§çš„å€¼å³å¯ï¼Œä¸éœ€è¦è¾“å‡ºå…·ä½“çš„ L,R*L*,*R*ã€‚

### è¾“å…¥æ ¼å¼

è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° n*n*ã€‚

ç¬¬äºŒè¡ŒåŒ…å« n*n* ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«è¡¨ç¤º A1,A2,â€¦,An*A*1,*A*2,â€¦,*A**n*ï¼Œç›¸é‚»ä¸¤ä¸ªæ•´æ•°ä¹‹é—´ä½¿ç”¨ä¸€ä¸ªç©ºæ ¼åˆ†éš”ã€‚

### è¾“å‡ºæ ¼å¼

è¾“å‡ºä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚

### æ ·ä¾‹è¾“å…¥

```
5
1 1 3 3 1
```

### æ ·ä¾‹è¾“å‡º

```
6
```

### è¯„æµ‹ç”¨ä¾‹è§„æ¨¡ä¸çº¦å®š

å¯¹äº 40%40% çš„è¯„æµ‹ç”¨ä¾‹ï¼Œ1â‰¤nâ‰¤50001â‰¤*n*â‰¤5000ï¼Œ1â‰¤Aiâ‰¤50001â‰¤*A**i*â‰¤5000ï¼›

å¯¹äºæ‰€æœ‰è¯„æµ‹ç”¨ä¾‹ï¼Œ1â‰¤nâ‰¤3Ã—1051â‰¤*n*â‰¤3Ã—105ï¼Œ1â‰¤Aiâ‰¤1091â‰¤*A**i*â‰¤109ã€‚

### é¢˜è§£ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;
#define int long long

signed main(){
    int n;
    cin>>n;
    vector<int> arr(n+2);
    for (int i=1;i<=n;i++){
        cin>>arr[i];
    }
    stack<int> l;
    vector<int> li(n+2);
    for (int i=1;i<=n;i++){
        while (!l.empty()&&arr[l.top()]>=arr[i]){
            l.pop();
        }
        li[i]=l.empty()?0:l.top();
        l.push(i);
    }//å·¦è¾¹ç¬¬ä¸€ä¸ªå°äºè‡ªå·±çš„
    stack<int> r;
    vector<int> ri(n+2);
    for (int i=n;i>=1;i--){
        while (!r.empty()&&arr[r.top()]>=arr[i]){
            r.pop();
        }
        ri[i]=r.empty()?0:r.top();
        r.push(i);
    }//y
    int ans=0;
    for (int i=1;i<=n;i++){
        int x=(ri[i]-li[i]-1)*arr[i];
        ans=max(ans,x);
    }
    cout<<ans<<endl;
    return 0;
}
```

é”™è¯¯ç¤ºèŒƒï¼ˆï¼‰ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;
#define int long long
signed main(){
   int n;
   cin>>n;
   vector<int> arr(n+2);
   for (int i=1;i<=n;i++){
      cin>>arr[i];
   }
   int maxx=0;
   for (int i=2;i<=n;i++){//iæ˜¯çª—å£å¤§å°
      deque<int> dep;
      vector<int> ans(n+2);
      for (int j=1;j<=n;j++){
         while (!dep.empty()&&arr[dep.back()]>=arr[j]){
            dep.pop_back();
         }
         while (!dep.empty()&&dep.front()<=j-i){
            dep.pop_front();
         }
         dep.push_back(j);
         ans[j]=arr[dep.front()];
      }
      for (int k=i;k<=n;k++){
         int ret=i*ans[k];
         if (ret>maxx) maxx=ret;
      }
   }
   cout<<maxx<<endl;
   return 0;
}
```

## ä¾‹é¢˜:æœ€å¤§çŸ©å½¢:

ç»™å®š *n* ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º 1 ã€‚

æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚

 

**ç¤ºä¾‹ 1:**

![img](C:\Users\asus\Desktop\ç¨‹åºè®¾è®¡\ç®—æ³•ç¬”è®°\ç®—æ³•ï¼šå•è°ƒåŒç«¯é˜Ÿåˆ—.assets\histogram.jpg)

```
è¾“å…¥ï¼šheights = [2,1,5,6,2,3]
è¾“å‡ºï¼š10
è§£é‡Šï¼šæœ€å¤§çš„çŸ©å½¢ä¸ºå›¾ä¸­çº¢è‰²åŒºåŸŸï¼Œé¢ç§¯ä¸º 10
```

**ç¤ºä¾‹ 2ï¼š**

![img](C:\Users\asus\Desktop\ç¨‹åºè®¾è®¡\ç®—æ³•ç¬”è®°\ç®—æ³•ï¼šå•è°ƒåŒç«¯é˜Ÿåˆ—.assets\histogram-1.jpg)

```
è¾“å…¥ï¼š heights = [2,4]
è¾“å‡ºï¼š 4
```

 

**æç¤ºï¼š**

- `1 <= heights.length <=105`
- `0 <= heights[i] <= 104`

### é¢˜è§£ï¼š

```cpp
class Solution {
public:
    int largestRectangleArea(vector<int>& h) {
        int n=h.size();
        vector<int> arr1(n+2);//å·¦è¾¹
        stack<int> st1;
        for (int i=0;i<n;i++){
            while (!st1.empty()&&h[st1.top()]>=h[i]){
                st1.pop();
            }
            arr1[i]=st1.empty()?-1:st1.top();
            st1.push(i);
        }
        vector<int> arr2(n+2);//å³è¾¹
        stack<int> st2;
        for (int i=n-1;i>=0;i--){
            while (!st2.empty()&&h[st2.top()]>=h[i]){
                st2.pop();
            }
            arr2[i]=st2.empty()?n:st2.top();
            st2.push(i);
        }
        int ans=0;
        for (int i=0;i<n;i++){
            ans=max(ans,(arr2[i]-arr1[i]-1)*h[i]);
        }
        return ans;
    }
};
```

æˆ‘ä»¬å½’çº³ä¸€ä¸‹æšä¸¾ã€Œé«˜ã€çš„æ–¹æ³•ï¼š

é¦–å…ˆæˆ‘ä»¬æšä¸¾æŸä¸€æ ¹æŸ±å­ i ä½œä¸ºé«˜ h=heights[i]ï¼›

éšåæˆ‘ä»¬éœ€è¦è¿›è¡Œå‘å·¦å³ä¸¤è¾¹æ‰©å±•ï¼Œä½¿å¾—æ‰©å±•åˆ°çš„æŸ±å­çš„é«˜åº¦å‡ä¸å°äº hã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å·¦å³ä¸¤ä¾§æœ€è¿‘çš„é«˜åº¦å°äº h çš„æŸ±å­ï¼Œè¿™æ ·è¿™ä¸¤æ ¹æŸ±å­ä¹‹é—´ï¼ˆä¸åŒ…æ‹¬å…¶æœ¬èº«ï¼‰çš„æ‰€æœ‰æŸ±å­é«˜åº¦å‡ä¸å°äº hï¼Œå¹¶ä¸”å°±æ˜¯ i èƒ½å¤Ÿæ‰©å±•åˆ°çš„æœ€è¿œèŒƒå›´ã€‚

## ä¾‹é¢˜ï¼š

### PAT B1030æ”¹ç‰ˆ

```cpp
#include <bits/stdc++.h>
using namespace std;

int n,p;
deque<int> maxx;
deque<int> minn;

int main(){
    cin>>n>>p;
    int x;
    vector<int> a;
    while (n--){
        cin>>x;
        a.push_back(x);
    }
    int ans=0;
    int l=0;
    for (int r=0;r<a.size();r++){//æ³¨æ„ï¼Œå•è°ƒåŒç«¯é˜Ÿåˆ—å­˜å‚¨çš„æ˜¯ä¸‹æ ‡
        while(!maxx.empty()&&a[maxx.back()]<=a[r]){
            maxx.pop_back();
        }
        maxx.push_back(r);
        while(!minn.empty()&&a[minn.back()]>=a[r]){
            minn.pop_back();
        }
        minn.push_back(r);
        while(!maxx.empty()&&!minn.empty()&&a[minn.front()]*p<a[maxx.front()]){
            if (minn.front()==l){
                minn.pop_front();
            }
            if (maxx.front()==l){
                maxx.pop_front();
            }
            l++;
        }
        ans=max(ans,r-l+1);
    }
    cout<<ans<<endl;
    return 0;
}
```

å½“ç„¶å¯ä»¥ï¼å•è°ƒé˜Ÿåˆ—æ˜¯è§£å†³â€œæ»‘åŠ¨çª—å£æœ€å€¼â€é—®é¢˜çš„åˆ©å™¨ï¼Œå°¤å…¶é€‚åˆä½ åˆšæ‰è¯´çš„é‚£ä¸ªâ€œè¿ç»­åŒºé—´çš„æœ€å¤§å€¼å’Œæœ€å°å€¼â€é—®é¢˜ã€‚æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹æ‹†å¼€è®²ã€‚

------

## ğŸŒŸ ä»€ä¹ˆæ˜¯å•è°ƒé˜Ÿåˆ—ï¼Ÿ

å•è°ƒé˜Ÿåˆ—ï¼ˆMonotonic Queueï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œå®ƒåœ¨é˜Ÿåˆ—ä¸­ç»´æŠ¤ä¸€ä¸ª**å•è°ƒé€’å¢**æˆ–**å•è°ƒé€’å‡**çš„åºåˆ—ã€‚

- **å•è°ƒé€’å‡é˜Ÿåˆ—**ï¼šé˜Ÿå¤´æ˜¯å½“å‰çª—å£çš„æœ€å¤§å€¼
- **å•è°ƒé€’å¢é˜Ÿåˆ—**ï¼šé˜Ÿå¤´æ˜¯å½“å‰çª—å£çš„æœ€å°å€¼

é€šè¿‡ä¿è¯é˜Ÿåˆ—çš„å•è°ƒæ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ O(1) æ—¶é—´è·å–å½“å‰çª—å£çš„æœ€å¤§å€¼/æœ€å°å€¼ã€‚

------

## ğŸ§  æ ¸å¿ƒæ€æƒ³

1. æ¯æ¬¡çª—å£å³ç§»ï¼ŒæŠŠæ–°å…ƒç´ æ’å…¥é˜Ÿåˆ—ï¼Œä½†è¦ä¿è¯å•è°ƒæ€§ï¼š
   - å¦‚æœè¦ç»´æŠ¤æœ€å¤§å€¼é˜Ÿåˆ—ï¼š
      æŠŠé˜Ÿå°¾æ‰€æœ‰æ¯”æ–°å…ƒç´ å°çš„éƒ½å¼¹æ‰ï¼Œå†æŠŠæ–°å…ƒç´ æ”¾è¿›é˜Ÿå°¾ã€‚
   - å¦‚æœè¦ç»´æŠ¤æœ€å°å€¼é˜Ÿåˆ—ï¼š
      æŠŠé˜Ÿå°¾æ‰€æœ‰æ¯”æ–°å…ƒç´ å¤§çš„éƒ½å¼¹æ‰ï¼Œå†æŠŠæ–°å…ƒç´ æ”¾è¿›é˜Ÿå°¾ã€‚
2. çª—å£å·¦ç§»ï¼ˆå³ l++ï¼‰ï¼Œå¦‚æœé˜Ÿå¤´å…ƒç´ å·²ç»ä¸åœ¨çª—å£èŒƒå›´ï¼Œå°±æŠŠé˜Ÿå¤´å¼¹æ‰ã€‚
3. é˜Ÿå¤´å…ƒç´ æ°¸è¿œæ˜¯å½“å‰çª—å£çš„æœ€å¤§å€¼/æœ€å°å€¼ã€‚

------

## ğŸ“Š ä¸¾ä¾‹æ¼”ç¤º

å‡è®¾æ•°ç»„ `a = [1, 3, 6, 4]`ï¼Œæˆ‘ä»¬è¦ç»´æŠ¤å½“å‰çª—å£çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚

------

### 1ï¸âƒ£ æ„å»º **æœ€å¤§å€¼é˜Ÿåˆ—**

ç›®æ ‡ï¼šé˜Ÿåˆ—ä¿æŒ**é€’å‡**ï¼Œé˜Ÿå¤´æœ€å¤§ã€‚

| æ­¥éª¤ | r    | æ–°å…ƒç´  | æ“ä½œ                    | é˜Ÿåˆ—å†…å®¹ï¼ˆå­˜å€¼ï¼‰ |
| ---- | ---- | ------ | ----------------------- | ---------------- |
| 1    | 0    | 1      | é˜Ÿåˆ—ç©ºï¼Œç›´æ¥æ’å…¥        | [1]              |
| 2    | 1    | 3      | 3 > 1ï¼Œå¼¹æ‰ 1ï¼Œå†æ’å…¥ 3 | [3]              |
| 3    | 2    | 6      | 6 > 3ï¼Œå¼¹æ‰ 3ï¼Œå†æ’å…¥ 6 | [6]              |
| 4    | 3    | 4      | 4 < 6ï¼Œç›´æ¥æ’å…¥         | [6, 4]           |

æ­¤æ—¶é˜Ÿå¤´ `6` å°±æ˜¯å½“å‰çª—å£æœ€å¤§å€¼ã€‚

------

### 2ï¸âƒ£ æ„å»º **æœ€å°å€¼é˜Ÿåˆ—**

ç›®æ ‡ï¼šé˜Ÿåˆ—ä¿æŒ**é€’å¢**ï¼Œé˜Ÿå¤´æœ€å°ã€‚

| æ­¥éª¤ | r    | æ–°å…ƒç´  | æ“ä½œ                    | é˜Ÿåˆ—å†…å®¹ï¼ˆå­˜å€¼ï¼‰ |
| ---- | ---- | ------ | ----------------------- | ---------------- |
| 1    | 0    | 1      | é˜Ÿåˆ—ç©ºï¼Œç›´æ¥æ’å…¥        | [1]              |
| 2    | 1    | 3      | 3 > 1ï¼Œç›´æ¥æ’å…¥         | [1, 3]           |
| 3    | 2    | 6      | 6 > 3ï¼Œç›´æ¥æ’å…¥         | [1, 3, 6]        |
| 4    | 3    | 4      | 4 < 6ï¼Œå¼¹æ‰ 6ï¼Œå†æ’å…¥ 4 | [1, 3, 4]        |

æ­¤æ—¶é˜Ÿå¤´ `1` å°±æ˜¯å½“å‰çª—å£æœ€å°å€¼ã€‚

------

### 3ï¸âƒ£ çª—å£å·¦ç§»æ—¶æ›´æ–°

å¦‚æœçª—å£å·¦è¾¹ç•Œ `l` å³ç§»ä¸€ä½ï¼š

- æ£€æŸ¥é˜Ÿå¤´æ˜¯å¦ç­‰äº `l` ä½ç½®çš„å…ƒç´ ï¼Œå¦‚æœæ˜¯å°±å¼¹æ‰ï¼ˆå› ä¸ºå®ƒå·²ç»ä¸åœ¨çª—å£ä¸­äº†ï¼‰ã€‚
- ä¿æŒé˜Ÿåˆ—å•è°ƒæ€§ä¸å˜ã€‚

------

## â± æ—¶é—´å¤æ‚åº¦åˆ†æ

- æ¯ä¸ªå…ƒç´ æœ€å¤šå…¥é˜Ÿä¸€æ¬¡ã€å‡ºé˜Ÿä¸€æ¬¡ï¼Œå› æ­¤æ€»å¤æ‚åº¦ **O(n)**ã€‚
- è·å–æœ€å¤§å€¼/æœ€å°å€¼æ˜¯ O(1)ã€‚

------

## ğŸ§© å›åˆ°æˆ‘ä»¬çš„è¿ç»­åŒºé—´é—®é¢˜

æˆ‘ä»¬ç»´æŠ¤ï¼š

- ä¸€ä¸ªå•è°ƒé€’å‡é˜Ÿåˆ— `maxQ`ï¼Œç”¨æ¥è·å–å½“å‰çª—å£çš„æœ€å¤§å€¼ã€‚
- ä¸€ä¸ªå•è°ƒé€’å¢é˜Ÿåˆ— `minQ`ï¼Œç”¨æ¥è·å–å½“å‰çª—å£çš„æœ€å°å€¼ã€‚

æ£€æŸ¥æ¡ä»¶ï¼š

```cpp
while (!maxQ.empty() && !minQ.empty() && a[maxQ.front()] > a[minQ.front()] * p) {
    if (maxQ.front() == l) maxQ.pop_front();
    if (minQ.front() == l) minQ.pop_front();
    l++;
}
```

å°±æ˜¯ä¿è¯ï¼š

æœ€å¤§å€¼â‰¤æœ€å°å€¼Ã—p\text{æœ€å¤§å€¼} \le \text{æœ€å°å€¼} \times p

ä¸æ»¡è¶³å°±æ”¶ç¼©çª—å£ï¼ˆl++ï¼‰ï¼Œå¹¶æ›´æ–°é˜Ÿåˆ—ã€‚

------

âœ… **æ€»ç»“ï¼š**

- å•è°ƒé€’å‡é˜Ÿåˆ— â†’ O(1) å¾—åˆ°æœ€å¤§å€¼
- å•è°ƒé€’å¢é˜Ÿåˆ— â†’ O(1) å¾—åˆ°æœ€å°å€¼
- é…åˆæ»‘åŠ¨çª—å£ â†’ O(n) æ±‚å‡ºæœ€é•¿åˆæ³•åŒºé—´

